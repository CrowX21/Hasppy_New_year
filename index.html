<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Happy New Year Neon</title>

<style>
body{
    margin:0;
    background:black;
    overflow:hidden;
    font-family:Arial,sans-serif;
}
canvas{
    position:fixed;
    inset:0;
}
</style>
</head>

<body>

<canvas id="canvas"></canvas>

<script>
/* ===== CANVAS ===== */
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");

function resize(){
    const dpr = Math.min(devicePixelRatio || 1, 2);
    canvas.width = innerWidth * dpr;
    canvas.height = innerHeight * dpr;
    canvas.style.width = innerWidth + "px";
    canvas.style.height = innerHeight + "px";
    ctx.setTransform(dpr,0,0,dpr,0,0);
}
resize();
addEventListener("resize", resize);

/* ===== BACKGROUND FIREWORK ===== */
let bg=[];
function spawnBG(){
    const x=Math.random()*innerWidth;
    const y=Math.random()*innerHeight*0.45;
    const count=innerWidth<700?25:60;
    for(let i=0;i<count;i++){
        const a=Math.random()*Math.PI*2;
        const s=Math.random()*4+2;
        bg.push({
            x,y,
            vx:Math.cos(a)*s,
            vy:Math.sin(a)*s,
            life:80,
            color:`hsl(${Math.random()*360},100%,60%)`
        });
    }
}
setInterval(spawnBG,900);

/* ===== TEXT FIREWORK (FIX TOTAL) ===== */
let particles=[];
let phase="explode";

function fireworkText(text, yRatio){
    const temp=document.createElement("canvas");
    const tctx=temp.getContext("2d");

    /* SAFE CANVAS */
    const safeMargin = innerHeight * 0.25;
    temp.width = innerWidth;
    temp.height = innerHeight + safeMargin*2;

    /* POSISI AMAN */
    const centerY = innerHeight * yRatio + safeMargin;

    /* FONT BERDASARKAN TINGGI LAYAR */
    const fontSize = Math.min(
        innerHeight * 0.18,
        innerWidth < 700 ? 56 : 140
    );

    tctx.clearRect(0,0,temp.width,temp.height);
    tctx.fillStyle="white";
    tctx.textAlign="center";
    tctx.textBaseline="middle";
    tctx.font=`bold ${fontSize}px Arial`;
    tctx.fillText(text, temp.width/2, centerY);

    const data=tctx.getImageData(0,0,temp.width,temp.height).data;

    particles.length = 0;

    for(let y=0;y<temp.height;y+=10){
        for(let x=0;x<temp.width;x+=10){
            const i=(y*temp.width+x)*4;
            if(data[i+3]>150){
                const a=Math.random()*Math.PI*2;
                const s=Math.random()*5+2;
                particles.push({
                    x:innerWidth/2,
                    y:innerHeight*yRatio,
                    vx:Math.cos(a)*s,
                    vy:Math.sin(a)*s,
                    tx:x,
                    ty:y-safeMargin,
                    color:`hsl(${Math.random()*360},100%,60%)`
                });
            }
        }
    }

    phase="explode";
    setTimeout(()=>phase="form",1400);
}

/* ===== SHOW ===== */
setTimeout(()=>{
    fireworkText("HAPPY NEW YEAR",0.5);
},1000);

/* ===== ANIMATE ===== */
function animate(){
    ctx.clearRect(0,0,innerWidth,innerHeight);

    bg.forEach((p,i)=>{
        p.x+=p.vx; p.y+=p.vy;
        p.vy+=0.04; p.life--;
        ctx.shadowBlur=12;
        ctx.shadowColor=p.color;
        ctx.fillStyle=p.color;
        ctx.fillRect(p.x,p.y,2,2);
        if(p.life<=0) bg.splice(i,1);
    });

    particles.forEach(p=>{
        if(phase==="explode"){
            p.x+=p.vx; p.y+=p.vy;
            p.vx*=0.9; p.vy*=0.9;
        }else{
            p.x+=(p.tx-p.x)*0.08;
            p.y+=(p.ty-p.y)*0.08;
        }
        ctx.shadowBlur=16;
        ctx.shadowColor=p.color;
        ctx.fillStyle=p.color;
        ctx.fillRect(p.x,p.y,3,3);
    });

    ctx.shadowBlur=0;
    requestAnimationFrame(animate);
}
animate();
</script>

</body>
</html>
